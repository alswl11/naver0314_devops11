<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bagel+Fat+One&family=Black+Han+Sans&family=Bungee+Spice&family=Diphylleia&family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Nanum+Pen+Script&family=Song+Myung&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <style>
        body * {
            font-family: "Song Myung";
        }

        h5.formtitle {
            cursor: pointer;
            width: 200px;
            border: 1px solid gray;
        }

        img.photo {
            position: absolute;
            left: 350px;
            top: 150px;
            width: 150px;
            border: 3px solid gray;
        }
        .buttons button {
            width: 100px;
        }
        .buttons {
            margin-bottom: 10px;
        }
        img.smallphoto {
            width: 40px;
            height: 40px;
            border: 1px solid gray;
            margin-right: 5px;
        }
        div.colorbox {
            width: 30px;
            height: 30px;
            border: 1px solid black;
            border-radius: 100px;
        }


    </style>
    <script>
        $(function () {
            list();
            $("div.shopform").hide();

            // 상품등록 폼 나타내기 이벤트
            $("h5.formtitle").click(function () {
                $(this).next().slideToggle('fast');
            });

            // 순차 btn evets
            $("#btn1").click(function () {
                localStorage.idx = 1;
                list();
            });
            $("#btn2").click(function () {
                localStorage.idx = 2;
                list();
            });
            $("#btn3").click(function () {
                localStorage.idx = 3;
                list();
            });
            $("#btn4").click(function () {
                localStorage.idx = 4;
                list();
            });

            // submit event
            $("#shopfrm").submit(function (e) {
                // action이 호출되는 기본 이벤트를 무효화한다
                e.preventDefault();
                // form 안의 모든 name으로 된 data를 읽어오려면
                let data = $(this).serialize();
                // alert(data);
                $.ajax({
                    type: "post",
                    dataType: "html",
                    url : "./data/insertshop.jsp",
                    data : data,
                    success : function () {
                        // insert 성공 후 목록 출력
                        list();
                        // 입력값 초기화 후 숨기기
                        $("#sname").val("");
                        $("#sprice").val("");
                        $("#scount").val("0");

                        $("#div.shopform").slideUp('fast');
                    }
                });
            });

            $(document).on("click", ".btndelete", function (e) {
                e.preventDefault();
                let shopidx = $(this).attr("shopidx");
                let a = confirm("삭제하시겠습니까?");
                if(a) {
                    $.ajax({
                        type : "get",
                        data : {"shopidx" : shopidx},
                        dataType : "html",
                        url : "./data/deleteshop.jsp",
                        success : function () {
                            list();
                        }
                    })
                }
            });

            $(document).on("click", ".btndetail", function (e) {
                e.preventDefault();
                let shopidx = $(this).attr("shopidx");
                $.ajax({
                    type : "get",
                    dataType : "json",
                    data : {"shopidx" : shopidx},
                    url : "./data/selectdata.jsp",
                    success : function (data) {
                        $("#modal-num").text("번호 : " +data.shopidx);
                        $("#modal-sname").text("상품명 : " + data.sname);
                        $("#modal-scolor").text("색상 : " + data.scolor);
                        $("#modal-sprice").text("가격 : "+ data.sprice);
                        $("#modal-sphoto").attr("src", data.sphoto);
                    }
                })
            });

        });
        // idx : 1 -> 등록순
        // idx : 2 -> 낮은 가격순
        // idx : 3 -> 높은 가격순
        // idx : 4 -> 상품명순
        function list() {
            let idx = localStorage.idx;
            if(idx == null)
               idx = 1;

            console.log("idx = " + idx);

            $("div.shoplist").empty();
            if(idx == 1)
                $("div.shoplist").append(`<h6 class="alert alert-danger">등록순 상품</h6>`);
            if(idx == 2)
                $("div.shoplist").append(`<h6 class="alert alert-success">낮은 가격순 상품</h6>`);
            if(idx == 3)
                $("div.shoplist").append(`<h6 class="alert alert-warning">높은 가격순 상품</h6>`);
            if(idx == 4)
                $("div.shoplist").append(`<h6 class="alert alert-info">상품명순 상품</h6>`);

            $.ajax({
                type : "get",
                data : {"idx" : idx},
                dataType : "json",
                url : "./data/listshop.jsp",
                success : function(data) {
                    let s =`<b>총 ${data.length}개의 상품이 있습니다</b>`;
                    // 상품 목록 출력
                    s+=
                        `
                        <table class="table table-striped">
                        <tr class="table-danger">
                        <th width="50">번호</th>
                        <th width="150">상품명</th>
                        <th width="70">색상</th>
                        <th width="100">가격</th>
                        <th width="80">상세보기</th>
                        <th>삭제</th>
                        `;
                    $.each(data, function (idx, ele) {
                        s+=
                            `
                            <tr>
                            <td align="center">${idx + 1}</td>
                            <td><img src="${ele.sphoto}" class="smallphoto">${ele.sname}</td>
                            <td>
                            <div class="colorbox" style="background-color: ${ele.scolor}"></div>
                            </td>
                            <td align="left">${ele.sprice}</td>
                            <td><button type="button" class="btn btn-success btn-sm btndetail" shopidx = "${ele.shopidx}" data-bs-toggle="modal" data-bs-target="#myModalUpdate">Detail</button></td>
                            <td><button type="button" class="btn btn-danger btn-sm btndelete" shopidx = "${ele.shopidx}">Delete</button></td>
                            </tr>
                            `;
                    });
                    s+="</table>";
                    $("div.shoplist").append(s);
                }
            });
        }
    </script>
</head>
<body>
<div style="margin: 10px">
    <h5 class="formtitle alert alert-success">
        <i class="bi bi-pencil-fill"></i> 상품등록하기</h5>

    <div class="shopform" style="width: 300px">
        <form id="shopfrm">
            <table class="table table-bordered">
                <caption align="top"><b>상품 등록</b></caption>
                <tr>
                    <th width="100" class="table-danger">상품명</th>
                    <td>
                        <input type="text" name="sname" id="sname" class="form-control" required="required">
                    </td>
                </tr>
                <tr>
                    <th width="100" class="table-danger">상품가격</th>
                    <td>
                        <input type="text" name="sprice" id="sprice" class="form-control" required="required">
                    </td>
                </tr>
                <tr>
                    <th width="100" class="table-danger">상품갯수</th>
                    <td>
                        <input type="number" name="scount" id="scount" class="form-control" min="1" max="5" step="1" value="1">
                    </td>
                </tr>
                <tr>
                    <th width="100" class="table-danger">상품색상</th>
                    <td>
                        <input type="color" name="scolor" id="scolor" class="form-control" value="#ccffff">
                    </td>
                </tr>
                <tr>
                    <th width="100" class="table-danger">상품사진</th>
                    <td>
                        <select name="sphoto" id="sphoto" class="form-select">
                            <script>
                                for(let i = 1; i<=34; i++) {
                                    let s = `<option value="../shop/${i}.${i==24?"gif":"jpg"}">상품번호 ${i}</option>`;
                                    document.write(s);
                                }
                            </script>
                        </select>
                        <img src="../shop/1.jpg" class="photo">
                        <script type="text/javascript">
                            $("#sphoto").change(function () {
                                $(".photo").attr("src", $(this).val());
                            })
                        </script>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" align="center">
                        <button type="submit" class="btn btn-secondary">DB에 저장</button>
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <hr>
    <div class="buttons">
        <button type="button" class="btn btn-sm btn-secondary" id="btn1">등록순</button>
        <button type="button" class="btn btn-sm btn-secondary" id="btn2">낮은 가격순</button>
        <button type="button" class="btn btn-sm btn-secondary" id="btn3">높은 가격순</button>
        <button type="button" class="btn btn-sm btn-secondary" id="btn4">상품명순</button>
    </div>
    <div class="shoplist" style="width: 500px">출력</div>
</div>
<!-- The Modal 수정시 호출되는 modal dialog-->
<div class="modal" id="myModalUpdate">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">상세보기</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="">
                    <p id="modal-num"></p>
                    <p id="modal-sname"></p>
                    <p id="modal-scolor"></p>
                    <p id="modal-sprice"></p>
                    <img id="modal-sphoto">
                </div>
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">확인</button>
            </div>

        </div>
    </div>
</div>
</body>
</html>